name: Build & Release DevOS Tools

on:
  push:
    tags:
      - 'v*' # –ó–∞–ø—É—Å–∫ —Ç–æ–ª—å–∫–æ –Ω–∞ —Ç–µ–≥–∏ v1.0.0, v2.0.0 –∏ —Ç.–¥.
  workflow_dispatch: # –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫
  permissions:
  contents: write

jobs:
  build-and-release:
    name: Build & Release
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      # --- SETUP ---
      - name: Setup Go
        uses: actions/setup-go@v4
        with:
          go-version: '1.25'
      
      - name: Setup Rust
        uses: actions-rs/toolchain@v1
        with:
          toolchain: stable
          profile: minimal
      
      # --- DEPENDENCIES ---
      - name: Install System Dependencies
        run: |
          sudo apt-get update
          # libpcap (d-shark), libssl (d-ransom), build-essential (gcc)
          sudo apt-get install -y libpcap-dev libssl-dev pkg-config build-essential libudev-dev

      # --- BUILD ---
      - name: Build All Tools via Makefile
        run: |
          make all
          ls -lh dist/

      # --- RELEASE ---
      - name: Create Release
        uses: softprops/action-gh-release@v1
        if: startsWith(github.ref, 'refs/tags/')
        with:
          files: dist/*
          token: ${{ secrets.GITHUB_TOKEN }}
          draft: false
          prerelease: false
          name: DevOS Toolkit ${{ github.ref_name }}
          body: |
            ## üöÄ DevOS Toolkit ${{ github.ref_name }}
            
            Automated release containing the full suite of DevOS utilities.
            
            ### üì¶ Included Tools:
            
            #### üîç Reconnaissance & Analysis
            - **d-env**: Project MRI (Deep inspection of Git, Docker, K8s stacks)
            - **d-recon**: Unified Reconnaissance Orchestrator (Nmap, Masscan, BBOT)
            
            #### üõ°Ô∏è Defense & Monitoring
            - **d-guard**: Security Gateway (Secret scanning, Trivy integration)
            - **d-ci**: CI/CD Pipeline Monitor (GitHub Actions)
            - **d-top**: Infrastructure Control Center (System, SSH, Docker dashboard)
            - **d-shark**: Terminal Network Analyzer (Tshark wrapper with process mapping)
            
            #### ‚öîÔ∏è Red Team & Simulation
            - **d-ransom**: Network propagation & encryption simulator
            - **d-paladin**: Active defense daemon (Honeypots, Grid Defense)